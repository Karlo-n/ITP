<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannabis - Galería de Imágenes | InfoSustancias</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../cannabis/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="logo">
                <h1>InfoSustancias</h1>
                <p class="tagline">Información y Educación sobre Sustancias</p>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="/">Inicio</a></li>
                    <li><a href="/articulos">Artículos</a></li>
                    <li><a href="/recursos">Recursos</a></li>
                    <li><a href="/ayuda">Ayuda</a></li>
                    <li><a href="/acerca">Acerca de</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Barra de navegación de sustancias -->
    <section class="substance-buttons">
        <div class="container">
            <div class="buttons-container">
                <a href="/cannabis" class="substance-button cannabis-btn">Cannabis</a>
                <a href="/fentanillo" class="substance-button fentanyl-btn">Fentanilo</a>
                <a href="/alcohol" class="substance-button alcohol-btn">Alcohol</a>
                <a href="/inhalables" class="substance-button inhalants-btn">Inhalables</a>
                <a href="/metanfetamina" class="substance-button methamphetamine-btn">Metanfetamina</a>
                <a href="/vapeadores" class="substance-button vaping-btn">Vapeadores/Tabaco</a>
                <a href="/benzodiazepinas" class="substance-button benzos-btn">Benzodiazepinas</a>
            </div>
        </div>
    </section>

    <main>
        <div class="container">
            <div class="gallery-container">
                <h1 class="gallery-title">Galería de Imágenes: Cannabis</h1>
                
                <div class="image-container" id="imageContainer">
                    <!-- Controles de navegación (solo flechas) -->
                    <div class="gallery-controls">
                        <div class="nav-btn left" onclick="changeImage(-1)">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="15 18 9 12 15 6"></polyline>
                            </svg>
                        </div>
                        <div class="nav-btn right" onclick="changeImage(1)">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>
                    </div>
                    
                    <!-- Imágenes de la galería -->
                    <img src="cannabis-1.jpg" alt="Cannabis Imagen 1" class="gallery-image active" data-index="0">
                    <img src="cannabis-2.jpg" alt="Cannabis Imagen 2" class="gallery-image" data-index="1">
                    <img src="cannabis-3.jpg" alt="Cannabis Imagen 3" class="gallery-image" data-index="2">
                    <img src="cannabis-4.jpg" alt="Cannabis Imagen 4" class="gallery-image" data-index="3">
                    
                    <!-- Descripción de la imagen -->
                    <div class="gallery-caption">
                        La planta de cannabis contiene más de 100 compuestos únicos llamados cannabinoides, siendo el THC y el CBD los más estudiados.
                    </div>
                </div>
                
                <!-- Puntos de navegación -->
                <div class="gallery-nav">
                    <div class="nav-dot active" onclick="showImage(0)"></div>
                    <div class="nav-dot" onclick="showImage(1)"></div>
                    <div class="nav-dot" onclick="showImage(2)"></div>
                    <div class="nav-dot" onclick="showImage(3)"></div>
                </div>
                
                <div class="gallery-info">
                    <p>Esta galería muestra diferentes aspectos relacionados con el cannabis, desde la planta en sus distintas etapas hasta representaciones de sus efectos y usos medicinales y recreativos.</p>
                    <p>El contenido tiene fines exclusivamente educativos e informativos, como parte de nuestro compromiso con la educación basada en evidencia científica.</p>
                </div>
                
                <!-- Sección de comentarios -->
                <div class="comments-section">
                    <div class="comments-header">
                        <h2 class="comments-title">Comentarios</h2>
                        <div class="comments-stats">
                            <span class="comments-count" id="totalComments">0 comentarios</span>
                            <div class="average-rating">
                                <span class="star" id="star1">★</span>
                                <span class="star" id="star2">★</span>
                                <span class="star" id="star3">★</span>
                                <span class="star" id="star4">★</span>
                                <span class="star" id="star5">★</span>
                                <span class="rating-value" id="avgRating">0.0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Formulario para añadir comentarios -->
                    <div class="comment-form">
                        <h3>Deja tu comentario</h3>
                        <form id="commentForm">
                            <div class="form-group">
                                <label for="commentName">Nombre</label>
                                <input type="text" id="commentName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="commentEmail">Email (no será publicado)</label>
                                <input type="email" id="commentEmail" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label>Calificación</label>
                                <div class="rating-selector">
                                    <input type="radio" id="star5" name="rating" value="5">
                                    <label for="star5">★</label>
                                    <input type="radio" id="star4" name="rating" value="4">
                                    <label for="star4">★</label>
                                    <input type="radio" id="star3" name="rating" value="3">
                                    <label for="star3">★</label>
                                    <input type="radio" id="star2" name="rating" value="2">
                                    <label for="star2">★</label>
                                    <input type="radio" id="star1" name="rating" value="1">
                                    <label for="star1">★</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="commentText">Comentario</label>
                                <textarea id="commentText" class="form-control" rows="4" required></textarea>
                            </div>
                            <button type="submit" class="submit-btn">Publicar comentario</button>
                        </form>
                    </div>
                    
                    <!-- Mejores comentarios -->
                    <div class="top-comments">
                        <h3>Mejores comentarios</h3>
                        <div id="topCommentsList">
                            <!-- Los comentarios se cargarán dinámicamente aquí -->
                        </div>
                        
                        <!-- Botón para mostrar todos los comentarios -->
                        <button class="show-more-btn" id="showMoreBtn">Ver todos los comentarios</button>
                    </div>
                    
                    <!-- Todos los comentarios (inicialmente ocultos) -->
                    <div class="all-comments" id="allComments">
                        <h3>Todos los comentarios</h3>
                        <div id="allCommentsList">
                            <!-- Los comentarios se cargarán dinámicamente aquí -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>InfoSustancias</h3>
                    <p>Un proyecto educativo desarrollado por estudiantes con fines exclusivamente informativos y académicos.</p>
                </div>
                <div class="footer-column">
                    <h4>Enlaces rápidos</h4>
                    <ul>
                        <li><a href="/">Inicio</a></li>
                        <li><a href="/articulos">Artículos</a></li>
                        <li><a href="/recursos">Recursos</a></li>
                        <li><a href="/ayuda">Ayuda</a></li>
                        <li><a href="/acerca">Acerca de</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Aviso legal</h4>
                    <p>Este sitio proporciona información educativa desarrollada por estudiantes con fines académicos y no sustituye el consejo médico profesional. La información presentada tiene únicamente propósitos informativos.</p>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 InfoSustancias. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script>
        // JavaScript para el funcionamiento de la galería
        let currentImageIndex = 0;
        const images = document.querySelectorAll('.gallery-image');
        const dots = document.querySelectorAll('.nav-dot');
        const captions = [
            "La planta de cannabis contiene más de 100 compuestos únicos llamados cannabinoides, siendo el THC y el CBD los más estudiados.",
            "El THC (tetrahidrocannabinol) es el principal componente psicoactivo del cannabis que interactúa con el sistema endocannabinoide del cerebro.",
            "El CBD (cannabidiol) es un componente no psicoactivo del cannabis que ha mostrado potencial terapéutico para varias condiciones médicas.",
            "Los efectos del cannabis varían significativamente dependiendo de la composición química, dosis, método de consumo y factores individuales."
        ];
        const captionElement = document.querySelector('.gallery-caption');
        const imageContainer = document.getElementById('imageContainer');

        // Verificar si hay imágenes disponibles
        function checkImages() {
            if (images.length === 0) {
                imageContainer.classList.add('no-images');
                return false;
            }
            return true;
        }

        // Función para mostrar una imagen específica
        function showImage(index) {
            if (!checkImages()) return;
            
            if (index < 0) index = images.length - 1;
            if (index >= images.length) index = 0;
            
            // Actualizar imágenes
            images.forEach(img => img.classList.remove('active'));
            images[index].classList.add('active');
            
            // Actualizar puntos de navegación
            dots.forEach(dot => dot.classList.remove('active'));
            dots[index].classList.add('active');
            
            // Actualizar leyenda
            captionElement.textContent = captions[index];
            
            currentImageIndex = index;
        }

        // Función para cambiar a la siguiente o anterior imagen
        function changeImage(direction) {
            if (!checkImages()) return;
            showImage(currentImageIndex + direction);
        }

        // Configurar intervalo para cambio automático de imágenes
        let slideInterval = setInterval(() => {
            if (checkImages()) {
                changeImage(1);
            }
        }, 5000);

        // Detener el cambio automático cuando el usuario interactúa con la galería
        imageContainer.addEventListener('mouseenter', () => {
            clearInterval(slideInterval);
        });

        // Reanudar el cambio automático cuando el usuario deja de interactuar
        imageContainer.addEventListener('mouseleave', () => {
            slideInterval = setInterval(() => {
                if (checkImages()) {
                    changeImage(1);
                }
            }, 5000);
        });

        // Sistema de comentarios
        const commentForm = document.getElementById('commentForm');
        const showMoreBtn = document.getElementById('showMoreBtn');
        const allComments = document.getElementById('allComments');
        const allCommentsList = document.getElementById('allCommentsList');
        const topCommentsList = document.getElementById('topCommentsList');
        const totalCommentsElement = document.getElementById('totalComments');
        
        // Almacenamiento local para comentarios
        let comments = JSON.parse(localStorage.getItem('cannabisComments')) || [];
        
        // Función para generar el HTML de un comentario
        function createCommentHTML(comment) {
            let starsHTML = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= comment.rating) {
                    starsHTML += '<span>★</span>';
                } else {
                    starsHTML += '<span style="color: #e0e0e0;">★</span>';
                }
            }
            
            return `
                <div class="comment">
                    <div class="comment-header">
                        <span class="comment-author">${comment.author}</span>
                        <span class="comment-date">${comment.date}</span>
                    </div>
                    <div class="comment-rating">
                        ${starsHTML}
                    </div>
                    <p class="comment-content">${comment.content}</p>
                </div>
            `;
        }
        
        // Función para cargar todos los comentarios
        function loadAllComments() {
            allCommentsList.innerHTML = '';
            
            if (comments.length === 0) {
                allCommentsList.innerHTML = '<p>No hay comentarios aún. ¡Sé el primero en comentar!</p>';
                return;
            }
            
            comments.forEach(comment => {
                allCommentsList.innerHTML += createCommentHTML(comment);
            });
        }
        
        // Función para cargar los mejores comentarios (los 5 con mejor calificación)
        function loadTopComments() {
            topCommentsList.innerHTML = '';
            
            if (comments.length === 0) {
                topCommentsList.innerHTML = '<p>No hay comentarios aún. ¡Sé el primero en comentar!</p>';
                return;
            }
            
            // Ordenar comentarios por calificación (de mayor a menor)
            const sortedComments = [...comments].sort((a, b) => b.rating - a.rating);
            const topFive = sortedComments.slice(0, 5);
            
            topFive.forEach(comment => {
                topCommentsList.innerHTML += createCommentHTML(comment);
            });
        }
        
        // Función para calcular y mostrar la calificación promedio
        function updateAverageRating() {
            if (comments.length === 0) {
                document.querySelector('.rating-value').textContent = '0.0';
                const stars = document.querySelectorAll('.average-rating .star');
                stars.forEach(star => star.style.color = '#e0e0e0');
                return;
            }
            
            const totalRating = comments.reduce((sum, comment) => sum + comment.rating, 0);
            const averageRating = totalRating / comments.length;
            
            document.querySelector('.rating-value').textContent = averageRating.toFixed(1);
            
            // Actualizar estrellas visuales
            const stars = document.querySelectorAll('.average-rating .star');
            for (let i = 0; i < stars.length; i++) {
                if (i < Math.floor(averageRating)) {
                    stars[i].style.color = '#ffc107';
                } else {
                    stars[i].style.color = '#e0e0e0';
                }
            }
            
            // Actualizar contador de comentarios
            totalCommentsElement.textContent = `${comments.length} comentarios`;
        }
        
        // Manejar el envío del formulario de comentarios
        commentForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Obtener valores del formulario
            const name = document.getElementById('commentName').value;
            const email = document.getElementById('commentEmail').value;
            const content = document.getElementById('commentText').value;
            
            // Obtener calificación seleccionada
            let rating = 0;
            const ratingInputs = document.querySelectorAll('input[name="rating"]');
            for (const input of ratingInputs) {
                if (input.checked) {
                    rating = parseInt(input.value);
                    break;
                }
            }
            
            if (rating === 0) {
                alert('Por favor, selecciona una calificación');
                return;
            }
            
            // Crear nuevo comentario
            const newComment = {
                id: Date.now(),
                author: name,
                date: new Date().toLocaleDateString('es-ES', {day: 'numeric', month: 'long', year: 'numeric'}),
                rating: rating,
                content: content
            };
            
            // Añadir a la lista de comentarios
            comments.unshift(newComment);
            
            // Guardar en localStorage
            localStorage.setItem('cannabisComments', JSON.stringify(comments));
            
            // Actualizar visualización
            loadTopComments();
            loadAllComments();
            updateAverageRating();
            
            // Limpiar formulario
            commentForm.reset();
            
            // Mostrar mensaje de confirmación
            alert('¡Gracias por tu comentario!');
        });
        
        // Mostrar/ocultar todos los comentarios
        showMoreBtn.addEventListener('click', function() {
            allComments.classList.toggle('show');
            
            if (allComments.classList.contains('show')) {
                showMoreBtn.textContent = 'Mostrar menos';
            } else {
                showMoreBtn.textContent = 'Ver todos los comentarios';
            }
        });
        
        // Cargar comentarios al iniciar
        loadAllComments();
        loadTopComments();
        updateAverageRating();
        
        // Verificar imágenes al cargar
        checkImages();
    </script>
</body>
</html>
